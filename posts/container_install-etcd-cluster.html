<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="怎样安装etcd集群" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="撰写时间：2021-01-17，整理时间：2023-01-28" /><meta property="og:description" content="撰写时间：2021-01-17，整理时间：2023-01-28" /><link rel="canonical" href="https://blog.algs.tech/posts/container_install-etcd-cluster.html" /><meta property="og:url" content="https://blog.algs.tech/posts/container_install-etcd-cluster.html" /><meta property="og:site_name" content="极客开发者-博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-28T14:50:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="怎样安装etcd集群" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-28T14:50:00+08:00","datePublished":"2023-01-28T14:50:00+08:00","description":"撰写时间：2021-01-17，整理时间：2023-01-28","headline":"怎样安装etcd集群","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.algs.tech/posts/container_install-etcd-cluster.html"},"url":"https://blog.algs.tech/posts/container_install-etcd-cluster.html"}</script><title>怎样安装etcd集群 | 极客开发者-博客</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="极客开发者-博客"><meta name="application-name" content="极客开发者-博客"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/dist/fonts/main.css"><link rel="stylesheet" href="/assets/dist/bootstrap.min.css"><link rel="stylesheet" href="/assets/dist/fontawesome.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/dist/magnific-popup.min.css"> <script src="/assets/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/img/about/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">极客开发者-博客</a></div><div class="site-subtitle font-italic">在探索未知与梦想的道路上，让我们拥有共同的称呼 -- 开发者</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/geekdex" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['pan.hy','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>怎样安装etcd集群</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>怎样安装etcd集群</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1674888600" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2023/01/28 </em> </span> <span style="float: right;"> <a href="https://lab.aoco.tech/convert?url=https://raw.githubusercontent.com/geekdex/blog/refs/heads/main/_posts/2023-01-28-container_install-etcd-cluster.md" class="view-source" target="_blank" style="color: #2a5caa; text-decoration: none; font-weight: 500;"> 查看Codelabs </a> &nbsp;|&nbsp; <a href="https://github.com/geekdex/blog/blob/main/_posts/2023-01-28-container_install-etcd-cluster.md" class="view-source" target="_blank" style="color: #2a5caa; text-decoration: none; font-weight: 500;"> 查看源码 </a> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://blog.algs.tech">blog.algs.tech</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2795 字"> <em>15 分钟</em>阅读</span></div></div></div><div class="post-content"><blockquote><p>撰写时间：2021-01-17，整理时间：2023-01-28</p></blockquote><p>etcd可以用于k8s集群的数据库，下面是在内网安装etcd集群的详细步骤</p><h2 id="一为etcd颁发ssl证书"><span class="mr-2">一、为etcd颁发SSL证书</span><a href="#一为etcd颁发ssl证书" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="11-颁发步骤"><span class="mr-2">1.1 颁发步骤</span><a href="#11-颁发步骤" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>加密证书我们可以向证书机构（CA）申请，但是由于我们部署在内网，我们自己自己创建一个CA后给自己颁发证书，步骤如下</p><ul><li>（1）创建证书颁发机构<li>（2）填写表单–写明etcd所在节点的IP<li>（3）向证书颁发结构申请证书</ul><h3 id="12-安装cfssl"><span class="mr-2">1.2 安装cfssl</span><a href="#12-安装cfssl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>从cfssl官网中选择对应的cfssl相关可执行程序，<a href="https://pkg.cfssl.org/">https://pkg.cfssl.org/</a> 这里直接使用wget下载保存到/usr/local/bin目录中</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># 下载cfssl</span>
wget <span class="nt">-c</span> https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 <span class="nt">-O</span> /usr/local/bin/cfssl
<span class="c"># 下载cfssl-certinfo</span>
wget <span class="nt">-c</span> https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 <span class="nt">-O</span> /usr/local/bin/cfssl-certinfo
<span class="c"># 下载cfssljson</span>
wget <span class="nt">-c</span> https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 <span class="nt">-O</span> /usr/local/bin/cfssljson
<span class="c"># 赋予cfssl相关可执行权限</span>
<span class="nb">chmod </span>a+x /usr/local/bin/cfssl<span class="k">*</span>
</pre></table></code></div></div><h3 id="13-颁发证书"><span class="mr-2">1.3 颁发证书</span><a href="#13-颁发证书" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="131-创建签证机构ca"><span class="mr-2">1.3.1 创建签证机构（CA）</span><a href="#131-创建签证机构ca" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>定义一个ca-csr.json文件，此文件定义签证机构（CA）的相关信息，填入以下内容</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"CN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etcd CA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"algo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"L"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Guizhou"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ST"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Qiandongnan"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>使用以下命令使用配置文件中，创建一个签证机构</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cfssl gencert <span class="nt">-initca</span> ca-csr.json | cfssljson <span class="nt">-bare</span> ca -
</pre></table></code></div></div><p>会生成一个ca.pem公钥文件和ca-key.pem私钥文件，这两个文件是CA服务器的证书。接下来我们需要给客户端颁发证书。</p><h4 id="132-定义证书信息"><span class="mr-2">1.3.2 定义证书信息</span><a href="#132-定义证书信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>先创建一个ca-config.json文件，定义待颁发证书的基本信息（如有效时间），填写以下内容</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"signing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"87600h"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"profiles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"www"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"87600h"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"usages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"signing"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"key encipherment"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"server auth"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"client auth"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>再创建一个server-csr.json文件，定义待颁发证书的详细信息，如下</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"CN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"etcd"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hosts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"192.168.56.101"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"192.168.56.102"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"192.168.56.103"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"algo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
        </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CN"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"L"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Guizhou"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ST"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Qiandongnan"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>相关参数</p><ul><li>CN：证书名称<li>hosts：颁发的主机<li>key：定义证书类型，algo为加密类型，size为加密长度<li>names：证书的基本信息</ul><h4 id="133-向签证机构ca申请证书"><span class="mr-2">1.3.3 向签证机构（CA）申请证书</span><a href="#133-向签证机构ca申请证书" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>完成以上步骤，使用以下命令给客户端申请证书</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cfssl gencert <span class="nt">-ca</span><span class="o">=</span>ca.pem <span class="nt">-ca-key</span><span class="o">=</span>ca-key.pem <span class="nt">-config</span><span class="o">=</span>ca-config.json <span class="nt">-profile</span><span class="o">=</span>www server-csr.json | cfssljson <span class="nt">-bare</span> server
</pre></table></code></div></div><p>此时，多出客户端两个证书相关文件server.pem和server-key.pem，使用<code class="language-plaintext highlighter-rouge">ls *pem</code>命令查看，可以看到四个pem文件，如下</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ca-key.pem  ca.pem  server-key.pem  server.pem
</pre></table></code></div></div><h2 id="二手动编译安装最新版本etcd"><span class="mr-2">二、手动编译安装最新版本etcd</span><a href="#二手动编译安装最新版本etcd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>我们从源码安装时，将安装最新的版本，包括步稳定的预览版本，此安装方式供大家学习，不见建议在生产环境中使用最新版本。</p><h3 id="21-安装golang"><span class="mr-2">2.1 安装golang</span><a href="#21-安装golang" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>etcd在构建的时候需要golang环境，所以先安装golang，使用以下命令</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># 添加golang镜像仓库</span>
rpm <span class="nt">--import</span> https://mirror.go-repo.io/centos/RPM-GPG-KEY-GO-REPO
curl <span class="nt">-s</span> https://mirror.go-repo.io/centos/go-repo.repo | <span class="nb">sudo tee</span> /etc/yum.repos.d/go-repo.repo
<span class="c"># 安装golang</span>
yum <span class="nb">install </span>golang <span class="nt">-y</span>
<span class="c"># 使用以下命令查看go安装版本</span>
go version
</pre></table></code></div></div><p>如果出现以下内容，则证明安装成功</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>go version go1.15.6 linux/amd64
</pre></table></code></div></div><p>此时，我们需要设置goproxy阿里云加速镜像，编辑/etc/profile文件，在末尾添加以下内容</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">GOPROXY</span><span class="o">=</span>https://mirrors.aliyun.com/goproxy/
</pre></table></code></div></div><p>并让/etc/profile里面的命令重新执行，使用以下命令</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">source</span> /etc/profile
</pre></table></code></div></div><h3 id="22-编译安装etcd"><span class="mr-2">2.2 编译安装etcd</span><a href="#22-编译安装etcd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>首先从github中下载源代码包，并执行构建命令</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/etcd-io/etcd.git
<span class="nb">cd </span>etcd
./build
</pre></table></code></div></div><p>最终若是输出类似以下内容，则证明构建成功</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>stderr: go: downloading github.com/urfave/cli v1.22.4                                     
stderr: go: downloading github.com/bgentry/speakeasy v0.1.0
stderr: go: downloading gopkg.in/cheggaaa/pb.v1 v1.0.28
stderr: go: downloading github.com/olekukonko/tablewriter v0.0.4
stderr: go: downloading github.com/mattn/go-runewidth v0.0.7
stderr: go: downloading github.com/cpuguy83/go-md2man/v2 v2.0.0
stderr: go: downloading github.com/russross/blackfriday/v2 v2.0.1
stderr: go: downloading github.com/shurcooL/sanitized_anchor_name v1.0.0
SUCCESS: etcd_build
</pre></table></code></div></div><p>最终编译构建成功之后生成的文件在源码目录下的bin目录，使用<code class="language-plaintext highlighter-rouge">ls -al bin/</code>命令可以查看到生成了etcd和etcdctl两个可执行文件</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>总用量 52112
drwxr-xr-x.  2 root root       33 1月  15 10:16 <span class="nb">.</span>
drwxr-xr-x. 19 root root     4096 1月  15 10:15 ..
<span class="nt">-rwxr-xr-x</span><span class="nb">.</span>  1 root root 29862882 1月  15 10:15 etcd
<span class="nt">-rwxr-xr-x</span><span class="nb">.</span>  1 root root 23492302 1月  15 10:16 etcdctl
</pre></table></code></div></div><p>此时我们可以把etcd可执行程序拷贝到系统中</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cp </span>bin/etcd<span class="k">*</span> /usr/local/bin
</pre></table></code></div></div><h2 id="三从etcd二进制文件包安装etcd"><span class="mr-2">三、从etcd二进制文件包安装etcd</span><a href="#三从etcd二进制文件包安装etcd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>etcd官方提供直接下载二进制文件进行安装的方式。如果使用二进制安装包安装，可以不安装golang，下载官方提供的二进制程序包进行解压后，可直接得到方式一中的etcd和etcdctl。下载地址为</p><p><a href="https://github.com/etcd-io/etcd/releases/">https://github.com/etcd-io/etcd/releases/</a></p><p>后续步骤和方式一一样，即先创建etcd目录，再把etcd和etcdctl两个文件拷贝到对应目录即可。</p><p>在写这篇文章的时候，etcd最新的稳定版本为3.4.14，所以我们指定3.4.14版本进行下载</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># 下载二进制程序包</span>
wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz
<span class="c"># 解压程序</span>
<span class="nb">tar</span> <span class="nt">-zxvf</span> etcd-v3.4.14-linux-amd64.tar.gz
<span class="c"># 复制二进制文件到系统</span>
<span class="nb">cp </span>etcd-v3.4.14-linux-amd64/etcd<span class="k">*</span> /usr/local/bin/
</pre></table></code></div></div><h2 id="四配置etcd服务管理脚本"><span class="mr-2">四、配置etcd服务管理脚本</span><a href="#四配置etcd服务管理脚本" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>我们已经将etcd安装到系统中，接下来我们需要编写etcd的systemd服务管理脚本，用systemd来管理etcd的启动。systemd知识属于Linux的系统知识，我们只介绍本次用到的知识点，其他部分在这里不会赘述。在Linux系统中，systemd服务管理脚本在以下两个目录</p><ul><li>系统脚本目录</ul><p>系统默认的服务脚本目录</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/etc/systemd/system
</pre></table></code></div></div><ul><li>用户脚本目录</ul><p>用户自定义脚本，通常保存在这个目录</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/usr/lib/systemd/system
</pre></table></code></div></div><p>创建一个systemd服务管理脚本<code class="language-plaintext highlighter-rouge">/usr/lib/systemd/system/etcd.service</code>，并在文件中定义内容。下文介绍启动etcd的两种方式。</p><h3 id="41-指定环境变量启动etcd"><span class="mr-2">4.1 指定环境变量启动etcd</span><a href="#41-指定环境变量启动etcd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在服务脚本文件中添加以下内容</p><div class="language-ini highlighter-rouge"><div class="code-header"> <span data-label-text="Ini"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nn">[Unit]</span><span class="w">
</span><span class="py">Description</span><span class="p">=</span><span class="s">Etcd Server</span>
<span class="py">After</span><span class="p">=</span><span class="s">network.target</span>
<span class="py">After</span><span class="p">=</span><span class="s">network-online.target</span>
<span class="py">Wants</span><span class="p">=</span><span class="s">network-online.target</span>
<span class="w">
</span><span class="nn">[Service]</span><span class="w">
</span><span class="py">Type</span><span class="p">=</span><span class="s">notify</span>
<span class="py">EnvironmentFile</span><span class="p">=</span><span class="s">/etc/etcd/conf/etcd.conf</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/usr/local/bin/etcd </span><span class="se">\
</span><span class="w">        </span><span class="s">--cert-file=/etc/etcd/ssl/server.pem </span><span class="se">\
</span><span class="w">        </span><span class="s">--key-file=/etc/etcd/ssl/server-key.pem </span><span class="se">\
</span><span class="w">        </span><span class="s">--peer-cert-file=/etc/etcd/ssl/server.pem </span><span class="se">\
</span><span class="w">        </span><span class="s">--peer-key-file=/etc/etcd/ssl/server-key.pem </span><span class="se">\
</span><span class="w">        </span><span class="s">--trusted-ca-file=/etc/etcd/ssl/ca.pem </span><span class="se">\
</span><span class="w">        </span><span class="s">--peer-trusted-ca-file=/etc/etcd/ssl/ca.pem</span>
<span class="py">Restart</span><span class="p">=</span><span class="s">on-failure</span>
<span class="py">LimitNOFILE</span><span class="p">=</span><span class="s">65536</span>
<span class="w">
</span><span class="nn">[Install]</span><span class="w">
</span><span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span>
</pre></table></code></div></div><p>syetemd参数配置文件的Unit节点用来定义元数据，Service节点用来配置服务，Install节点是配置文件的最后一个区块，用来定义服务启动方式</p><ul><li>[Unit] <strong>Description</strong>：服务描述<li>[Unit] <strong>After</strong>：当前Unit需要在哪些Unit启动之后启动<li><p>[Unit] <strong>Wants</strong>：与当前 Unit 配合的其他 Unit，如果其他Unit没有运行，当前 Unit 也不会启动失败</p><li>[Service] <strong>Type</strong>：定义启动进程的行为，值为notify时，代表当前服务启动完毕，会通知<code class="language-plaintext highlighter-rouge">Systemd</code>，再继续往下执行<li>[Service] <strong>EnvironmentFile</strong>：指定环境变量配置文件<li>[Service] <strong>ExecStart</strong>：启动当前服务的命令<li>[Service] <strong>Restart</strong>：定义何种情况 Systemd 会自动重启当前服务，on-failure代表服务停止后会重启<li><p>[Service] <strong>LimitNOFILE</strong>：设置资源限制，即用户最多可以使用多少个进程</p><li>[Install] <strong>WantedBy</strong>：当值为multi-user.target时，代表系统大部分默认服务启动了（不包含GUI），服务跟着启动。</ul><p>在systemd服务配置文件中，我们最需要关注的是[Service] ExecStart，这个参数定义systemd去哪里找etcd的启动程序，我们需要指定etcd具体的二进制文件所在路径。我们还指定了etcd运行时的环境变量配置文件，我们需要在对应的路径（/etc/etcd/conf/etcd.conf）创建其对应文件，并添加以下内容</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c">#[Member]</span>
<span class="nv">ETCD_NAME</span><span class="o">=</span><span class="s2">"etcd-1"</span>
<span class="nv">ETCD_DATA_DIR</span><span class="o">=</span><span class="s2">"/var/lib/etcd/default.etcd"</span>
<span class="nv">ETCD_LISTEN_PEER_URLS</span><span class="o">=</span><span class="s2">"https://192.168.56.101:2380"</span>
<span class="nv">ETCD_LISTEN_CLIENT_URLS</span><span class="o">=</span><span class="s2">"https://192.168.56.101:2379"</span>

<span class="c">#[Clustering]</span>
<span class="nv">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="o">=</span><span class="s2">"https://192.168.56.101:2380"</span>
<span class="nv">ETCD_ADVERTISE_CLIENT_URLS</span><span class="o">=</span><span class="s2">"https://192.168.56.101:2379"</span>
<span class="nv">ETCD_INITIAL_CLUSTER</span><span class="o">=</span><span class="s2">"etcd-1=https://192.168.56.101:2380,etcd-2=https://192.168.56.102:2380,etcd-3=https://192.168.56.103:2380"</span>
<span class="nv">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="o">=</span><span class="s2">"etcd-cluster"</span>
<span class="nv">ETCD_INITIAL_CLUSTER_STATE</span><span class="o">=</span><span class="s2">"new"</span>
</pre></table></code></div></div><p>在etcd的环境变量配置文件中，包含两段，[Member]之下是单节点配置参数，[Clustering]节点下是集群配置参数</p><ul><li><p>[Member] <strong>ETCD_NAME</strong>：当前etcd的唯一名称，要保证和其他节点不冲突</p><li><p>[Member] <strong>ETCD_DATA_DIR</strong>：指定etcd存储数据的存储位置</p><li><p>[Member] <strong>ETCD_LISTEN_PEER_URLS</strong>：指定当前etcd和其他节点etcd通信时的服务地址和端口。假如etcd集群中包含三个etcd服务，那么三个etcd节点构成了一个高可用集群，etcd集群会自动选举一个节点作为主节点，另外两个节点作为从节点。所有的写入操作将往主节点写，所有的读操作在从节点上读，这是etcd读写的过程。上述设置的2380端口，用来监听其他etcd节点发送过来的数据。</p><li><p>[Member] <strong>ETCD_LISTEN_CLIENT_URLS</strong>：指定当前etcd接收客户端指令的地址和端口，在这里的客户端我们指的是k8s集群的master节点。</p><li>[Clustering] <strong>ETCD_INITIAL_ADVERTISE_PEER_URLS</strong>：指定etcd广播端口，当前etcd会将数据同步到其他节点，通过2380端口发送。<li>[Clustering] <strong>ETCD_ADVERTISE_CLIENT_URLS</strong>：给客户端通告的端口。<li>[Clustering] <strong>ETCD_INITIAL_CLUSTER</strong>：定义etcd集群中所有节点的名称和IP，以及通信端口。<li>[Clustering] <strong>ETCD_INITIAL_CLUSTER_TOKEN</strong>：定义etcd集群中通信的token，所有节点必须一致。<li>[Clustering] <strong>ETCD_INITIAL_CLUSTER_STATE</strong>：定义etcd集群的状态，new代表新建集群，existing代表加入现有集群。</ul><h3 id="42-指定参数启动etcd"><span class="mr-2">4.2 指定参数启动etcd</span><a href="#42-指定参数启动etcd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果我们指定参数启动etcd，则不需要指定环境配置变量文件，这两种方式二选一即可</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Etcd Server
<span class="nv">After</span><span class="o">=</span>network.target
<span class="nv">After</span><span class="o">=</span>network-online.target
<span class="nv">Wants</span><span class="o">=</span>network-online.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>notify
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/etcd <span class="se">\</span>
        <span class="nt">--name</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_NAME</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--data-dir</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_DATA_DIR</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--listen-peer-urls</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_LISTEN_PEER_URLS</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--listen-client-urls</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_LISTEN_CLIENT_URLS</span><span class="k">}</span>,http://127.0.0.1:2379 <span class="se">\</span>
        <span class="nt">--advertise-client-urls</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_ADVERTISE_CLIENT_URLS</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--initial-advertise-peer-urls</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--initial-cluster</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_INITIAL_CLUSTER</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--initial-cluster-token</span><span class="o">=</span><span class="k">${</span><span class="nv">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="k">}</span> <span class="se">\</span>
        <span class="nt">--initial-cluster-state</span><span class="o">=</span>new <span class="se">\</span>
        <span class="nt">--cert-file</span><span class="o">=</span>/etc/etcd/ssl/server.pem <span class="se">\</span>
        <span class="nt">--key-file</span><span class="o">=</span>/etc/etcd/ssl/server-key.pem <span class="se">\</span>
        <span class="nt">--peer-cert-file</span><span class="o">=</span>/etc/etcd/ssl/server.pem <span class="se">\</span>
        <span class="nt">--peer-key-file</span><span class="o">=</span>/etc/etcd/ssl/server-key.pem <span class="se">\</span>
        <span class="nt">--trusted-ca-file</span><span class="o">=</span>/etc/etcd/ssl/ca.pem <span class="se">\</span>
        <span class="nt">--peer-trusted-ca-file</span><span class="o">=</span>/etc/etcd/ssl/ca.pem
<span class="nv">Restart</span><span class="o">=</span>on-failure
<span class="nv">LimitNOFILE</span><span class="o">=</span>65536

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></table></code></div></div><blockquote><p>注意：在systemd服务配置文件中，我们指定了etcd的SSL证书路径，我们需要把申请的etcd的SSL证书复制到对应的目录。另外，每个etcd节点的配置文件里的etcd名称一定要唯一，对应的服务IP与端口也不能出错。在k8s-master1节点安装好之后，k8s-node1和k8s-node2需要进行相同操作，SSL证书需要从k8s-master1节点上传输过去进行安装。</p></blockquote><h2 id="五启动etcd集群"><span class="mr-2">五、启动etcd集群</span><a href="#五启动etcd集群" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>所有节点都安装好etcd之后，每个节点一次执行以下命令</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># 启动etcd</span>
systemctl start etcd
<span class="c"># 设置开机自启</span>
systemctl <span class="nb">enable </span>etcd
</pre></table></code></div></div><p>启动完成之后，我们在任意节点使用etcdctl命令检查集群状态，需要注意的是，要确切指定证书的位置</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>etcdctl <span class="nt">--cacert</span><span class="o">=</span><span class="s2">"/etc/etcd/ssl/ca.pem"</span> <span class="nt">--cert</span><span class="o">=</span><span class="s2">"/etc/etcd/ssl/server.pem"</span> <span class="nt">--key</span><span class="o">=</span><span class="s2">"/etc/etcd/ssl/server-key.pem"</span> <span class="nt">--endpoints</span><span class="o">=</span><span class="s2">"https://192.168.56.101:2379,https://192.168.56.102:2379,https://192.168.56.103:2379"</span> endpoint health <span class="nt">--write-out</span><span class="o">=</span>table
</pre></table></code></div></div><p>如果显示一下信息，则etcd集群服务正常；如果不显示以下内容，则需要重新检查安装的每一个步骤，再来一次确保无误</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>+-----------------------------+--------+-------------+-------+
|          ENDPOINT           | HEALTH |    TOOK     | ERROR |
+-----------------------------+--------+-------------+-------+
| https://192.168.56.101:2379 |   <span class="nb">true</span> | 33.529463ms |       |
| https://192.168.56.103:2379 |   <span class="nb">true</span> | 38.145028ms |       |
| https://192.168.56.102:2379 |   <span class="nb">true</span> | 34.107771ms |       |
+-----------------------------+--------+-------------+-------+
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E5%8C%96/'>容器与虚拟化</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/k8s/" class="post-tag no-text-decoration" >k8s</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4%20-%20%E6%9E%81%E5%AE%A2%E5%BC%80%E5%8F%91%E8%80%85-%E5%8D%9A%E5%AE%A2&url=https%3A%2F%2Fblog.algs.tech%2Fposts%2Fcontainer_install-etcd-cluster.html" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4%20-%20%E6%9E%81%E5%AE%A2%E5%BC%80%E5%8F%91%E8%80%85-%E5%8D%9A%E5%AE%A2&u=https%3A%2F%2Fblog.algs.tech%2Fposts%2Fcontainer_install-etcd-cluster.html" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.algs.tech%2Fposts%2Fcontainer_install-etcd-cluster.html&text=%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4%20-%20%E6%9E%81%E5%AE%A2%E5%BC%80%E5%8F%91%E8%80%85-%E5%8D%9A%E5%AE%A2" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://service.weibo.com/share/share.php?title=%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85etcd%E9%9B%86%E7%BE%A4%20-%20%E6%9E%81%E5%AE%A2%E5%BC%80%E5%8F%91%E8%80%85-%E5%8D%9A%E5%AE%A2&url=https%3A%2F%2Fblog.algs.tech%2Fposts%2Fcontainer_install-etcd-cluster.html" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/pingora/">Pingora</a> <a class="post-tag" href="/tags/posix/">POSIX</a> <a class="post-tag" href="/tags/%E5%8F%8C%E7%B3%BB%E7%BB%9F/">双系统</a> <a class="post-tag" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/">虚拟机</a> <a class="post-tag" href="/tags/android%E6%9D%83%E9%99%90/">android权限</a> <a class="post-tag" href="/tags/aosp/">aosp</a> <a class="post-tag" href="/tags/archlinux/">archlinux</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div><script src="/assets/lib/tocbot/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tools_Fully-Manual-Installation-of-Kubernetes-v1.32.2-on-Debian-12.md-copy.html"><div class="card-body"> <em class="small" data-ts="1753348500" data-df="YYYY/MM/DD" > 2025/07/24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>在 Debian 12 上完全手动安装 kubernetes v1.32.2</h3><div class="text-muted small"><p> 基础环境准备 1.1 kubernetes集群组件概述 Kubernetes 集群由 Master 节点（控制节点）和 Node 节点（工作节点）组成，各自包含以下核心组件： 1.1.1 Master节点 etcd 分布式键值存储数据库，保存集群的所有状态和配置数据（如 Pod、Service、Namespace 等）。 是 Kubernete...</p></div></div></a></div><div class="card"> <a href="/posts/container_install-k8s-on-deepin-using-docker.html"><div class="card-body"> <em class="small" data-ts="1693199400" data-df="YYYY/MM/DD" > 2023/08/28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>在Ubunt上快速搭建k8s集群</h3><div class="text-muted small"><p> 一、准备环境 撰写时间：2023-08-28 我们需要借助一个工具叫做minicuke，网址：https://minikube.sigs.k8s.io/，安装好minicube之后，我们可以安装单机的k8s环境，如下步骤 我的环境是： Deepin 20.9 (基于debian 10) 二、安装过程 2.1 删除旧环境 如果之前安装过，可以执行以下步骤 1 2 3 4 ...</p></div></div></a></div><div class="card"> <a href="/posts/container_install-k8s-quickly-on-ubuntu.html"><div class="card-body"> <em class="small" data-ts="1674888660" data-df="YYYY/MM/DD" > 2023/01/28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>在Ubuntu上快速搭建k8s集群</h3><div class="text-muted small"><p> 撰写时间：2021-01-17，整理时间：2023-01-28 etcd可以用于k8s集群的数据库，下面是在内网安装etcd集群的详细步骤 一、为etcd颁发SSL证书 1.1 颁发步骤 加密证书我们可以向证书机构（CA）申请，但是由于我们部署在内网，我们自己自己创建一个CA后给自己颁发证书，步骤如下 （1）创建证书颁发机构 （2）填写表单–写明etcd所在节点的...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/container_run-php-on-docker.html" class="btn btn-outline-primary" prompt="上一篇"><p>怎样使用Docker运行php项目？</p></a> <a href="/posts/container_install-k8s-quickly-on-ubuntu.html" class="btn btn-outline-primary" prompt="下一篇"><p>在Ubuntu上快速搭建k8s集群</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "geekdex/blog", "data-repo-id": "R_kgDOIyxhcQ", "data-category": "General", "data-category-id": "DIC_kwDOIyxhcc4CUhya", "data-mapping": "pathname", "data-reactions-enabled": "anonymous", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "0", "data-lang": "zh-CN", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">k8s</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/pingora/">Pingora</a> <a class="post-tag" href="/tags/posix/">POSIX</a> <a class="post-tag" href="/tags/%E5%8F%8C%E7%B3%BB%E7%BB%9F/">双系统</a> <a class="post-tag" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/">虚拟机</a> <a class="post-tag" href="/tags/android%E6%9D%83%E9%99%90/">android权限</a> <a class="post-tag" href="/tags/aosp/">aosp</a> <a class="post-tag" href="/tags/archlinux/">archlinux</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://blog.algs.tech">blog.algs.tech</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="/assets/dist/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/dist/jquery.magnific-popup.min.js"></script> <script src="/assets/dist/lazysizes.min.js"></script> <script src="/assets/dist/clipboard.min.js"></script> <script src="/assets/dist/dayjs.min.js"></script> <script src="/assets/dist/locale/zh.min.js"></script> <script src="/assets/dist/relativeTime.min.js"></script> <script src="/assets/dist/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/dist/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
